# exif-renamer [![Build Status](https://secure.travis-ci.org/dylansmith/node-exif-renamer.png?branch=master)](http://travis-ci.org/dylansmith/node-exif-renamer)

A NodeJS service to rename images using their EXIF data.

## Installation
Install the module with: `npm install exif-renamer`

## Usage
First, import the module:

```javascript
var exifRenamer = require('exif-renamer');
```

exif-renamer supports node-style callbacks:

```javascript
exifRenamer.rename('path/to/image.file', '{{date "yyyy-mm-dd"}}_{{file}}', function(error, filename) {
    if (!error) {
        console.log('the file was renamed: ', filename);
    } else {
        console.log('an error occurred', error);
    }
});
```

It also supports promises (using the [Q library](https://www.npmjs.org/package/q)):

```javascript
exifRenamer
    .rename('path/to/image.file', '{{date "yyyy-mm-dd"}}_{{file}}')
    .then(function(filename) {
        console.log('the file was renamed: ', filename);
    })
    .catch(function(error) {
        console.log('an error occurred', error);
    })
    .done();
```

## Documentation

### Configuration
Coming soon.

### Renaming templates

The #process and #rename methods accept a `template` argument which is used to determine the new
filename for the renamed image. As the name might suggest, the template is a way for you to format
the filename using values present in the EXIF data.

`exif-renamer` uses [Handlebars](http://handlebarsjs.com/) for templating, which allows you to
easily access the image file metadata to construct just about any filename you could imagine, e.g.:

> Prefix the filename with the date (defaults to YYYY-MM-DD format):<br>
> `{{date}}_{{file}}`

> Prefix the filename with a custom date format (see [dateformat](https://www.npmjs.org/package/dateformat)):<br>
> `{{date "yy-mm"}}_{{file}}'`

> Move the image to a YYYY-MM directory:<br>
> `{{date "yyyy-mm"}}/{{file}}`

> Prefix the parent directory with the year:<br>
> `{{date "yyyy"}}-{{dir}}/{{file}}`

> Prefix the filename with the file extension and camera model:<br>
> `{{EXT}}-{{image.Model}}-{{file}}`

> Prefix the filename with the F-number:<br>
> `F{{exif.FNumber}}-{{file}}`

`date` (*datetime*, really) is currently the only metadata that supports additional formatting, via
the [dateformat module](https://www.npmjs.org/package/dateformat) as mentioned above.

#### Custom renaming

It is possible to pass your own custom function rather than a handlebars template, giving you total
control over the renaming process. Here is an example:

```javascript
doge_prefixer = function(fileinfo, metadata) {
    var dogeisms = ['very', 'wow', 'so', 'much'];
    console.log(arguments);
    return [dogeisms[Math.floor(Math.random() * dogeisms.length)], fileinfo.basename].join('_');
}

exifRenamer.process('path/to/image.file', doge_prefixer, function(err, result) {
    //...
});
```

#### Metadata

The metadata available to a handlebar template is a combination of the exif data generated by the
[exif module](https://www.npmjs.org/package/exif), path information, and some other useful stuff:

```json
{
    // EXIF data
    <see: https://www.npmjs.org/package/exif>,

    // path information
    path:     <the absolute path to the image>,
    basename: <the image filename>
    dirname:  <the image's parent directory>,
    extname:  <the image extension>,

    // other useful stuff
    'date':   <EXIF date in YYYY-MM-DD format>,
    'time':   <EXIF time in HH:MM:SS format>,
    'file':   <the image filename, alias for basename>,
    'dir':    <the image's parent directory, alias for dirname>,
    'ext':    <the image extension, lowercased>,
    'EXT':    <the image extension, uppercased>,
}
```

### Methods

#### #exif

Returns the EXIF data for an image.

** arguments **

- `filepath` the path to the image file
- `callback` the node-style callback that will receive the response

** usage **

```javascript
exifRenamer.exif('path/to/image.file', function(err, exifdata) {
    //...
});
```

#### #process

Takes an image and renaming template or callback and returns an object containing the renamed
image path, but does not actually rename the image (see #rename for this).

** arguments **

- `filepath` the path to the image file
- `template` the renaming template or a custom callback function
- `callback` the node-style callback that will receive the response

** usage **

```javascript
// using a handlebars template
exifRenamer.process('path/to/image.file', 'renaming-template', function(err, result) {
    //...
});

// using a custom function
exifRenamer.process('path/to/image.file', customRenamer, function(err, result) {
    //...
});
```

#### #rename

Takes an image and renaming template or callback and renames/moves the image.

** arguments **

- `filepath` the path to the image file
- `template` the renaming template or a custom callback function
- `callback` the node-style callback that will receive the response

** usage **

```javascript
// using a handlebars template
exifRenamer.rename('path/to/image.file', 'renaming-template', function(err, result) {
    //...
});

// using a custom function
exifRenamer.rename('path/to/image.file', customRenamer, function(err, result) {
    //...
});
```

#### #watch

Watches a specified directory, renaming all images that are added to that directory.

** arguments **

- `dirpath`  the path to the watch directory
- `template` the renaming template or a custom callback function
- `callback` the node-style callback that will receive the response

** usage **

```javascript
exifRenamer.watch('path/to/watch/dir', 'renaming-template', function(err, result) {
    //...
});
```

## Contributing
In lieu of a formal styleguide, take care to maintain the existing coding style. Add unit tests for any new or changed functionality. Lint and test your code using [Grunt](http://gruntjs.com/).

## Release History
0.1.0 - initial version, work in progress

## License
Copyright (c) 2014 Dylan Smith
Licensed under the MIT license.
